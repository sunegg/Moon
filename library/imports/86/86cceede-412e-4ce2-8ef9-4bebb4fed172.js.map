{"version":3,"sources":["assets/scripts/GameManager.ts"],"names":[],"mappings":";;;;;AAAA,oBAAoB;AACpB,wEAAwE;AACxE,mBAAmB;AACnB,kFAAkF;AAClF,8BAA8B;AAC9B,kFAAkF;;;;;;;;;;;;;;;;;;;;;AAElF,+BAA0B;AAC1B,iDAA4C;AAC5C,2CAAsC;AACtC,2CAAsC;AAEhC,IAAA,kBAAqC,EAAnC,oBAAO,EAAE,sBAA0B,CAAC;AAG5C;IAAyC,+BAAY;IADrD;QAAA,qEAsJC;QAtIC,YAAM,GAAe,IAAI,CAAC;QAG1B,WAAK,GAAW,CAAC,CAAC;QAGlB,mBAAa,GAAW,GAAG,CAAC;QAE5B,YAAM,GAAG,KAAK,CAAC;QAEf,cAAQ,GAAG,KAAK,CAAC;;IA4HnB,CAAC;oBArJoB,WAAW;IAwC9B,wBAAwB;IAEtB,4BAAM,GAAN;QAAA,iBAsED;QApEK,aAAW,CAAC,QAAQ,GAAG,IAAI,CAAC;QAC9B,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;QACpB,IAAI,CAAC,IAAI,CAAC,EAAE,CACV,UAAU,EACV;YACE,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;gBAClB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;gBACrB,4BAA4B;gBAC5B,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC;gBAChD,IAAI,CAAC,YAAY,CAAC,MAAM,GAAG,IAAI,CAAC;gBAChC,IAAI,IAAI,CAAC,YAAY,CAAC,IAAI,IAAI,IAAI;oBAChC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC;gBACnC,IAAI,IAAI,CAAC,SAAS,CAAC,IAAI,IAAI,IAAI;oBAC7B,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC;aACjC;QACH,CAAC,EACD,IAAI,CACL,CAAC;QAEF,IAAI,CAAC,IAAI,CAAC,EAAE,CACV,SAAS,EACT,UAAU,KAAK;YACd,sBAAsB;YACrB,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC;YAC7C,oBAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YACvC,IAAI,CAAC,KAAK,IAAG,KAAK,CAAC;YACnB,IAAI,CAAC,UAAU,CAAC,MAAM,GAAI,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC;QACjD,CAAC,EACD,IAAI,CACL,CAAC;QACN,IAAI,CAAC,IAAI,CAAC,EAAE,CACV,UAAU,EACV,UAAU,KAAK;YAEd,sBAAsB;YACtB,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAC,KAAK,EAAC,CAAC,CAAC,CAAC;YAE1C,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;YACrB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;YACnB,IAAI,CAAC,SAAS,CAAC,IAAI,GAAG,EAAE,CAAC,aAAa,CAAC,OAAO,CAAC;QACnD,CAAC,EACD,IAAI,CACL,CAAC;QACF,IAAI,CAAC,IAAI,CAAC,EAAE,CACV,YAAY,EACZ;YACE,IAAI,KAAI,CAAC,QAAQ,EAAE;gBACjB,KAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;gBACtB,KAAI,CAAC,UAAU,EAAE,CAAC;aACnB;QACH,CAAC,EACD,IAAI,CACL,CAAC;QACF,IAAI,CAAC,IAAI,CAAC,EAAE,CACR,MAAM,EACR;YACE,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;gBAClB,0BAA0B;gBAC1B,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,EAAC,KAAK,EAAC,CAAC,CAAC,CAAC;gBACxC,IAAI,CAAC,YAAY,CAAC,IAAI,GAAG,EAAE,CAAC,aAAa,CAAC,OAAO,CAAC;gBAClD,IAAI,CAAC,YAAY,CAAC,aAAa,GAAG,CAAC,CAAC;gBACpC,IAAI,CAAC,YAAY,CAAC,OAAO,GAAG,CAAC,CAAC;gBAC9B,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC;gBACnC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;aACpB;QACD,CAAC,EACD,IAAI,CACL,CAAC;IACN,CAAC;IAGD,8BAAQ,GAAR,UAAS,KAAK;QACZ,IAAI,IAAI,CAAC,KAAK,IAAI,EAAE,EAAE;YACpB,IAAI,CAAC,MAAM,CAAC,OAAO,GAAG,IAAI,CAAC;SAC5B;QACD,IAAI,IAAI,CAAC,MAAM,EAAE;YAEf,IAAI,CAAC,KAAK,IAAI,KAAK,CAAC;YACpB,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC;YAC/C,cAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAEpC,oBAAoB;YACrB,uBAAuB;YACvB,aAAa;YACZ,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;SACrB;IACH,CAAC;IAED,gCAAU,GAAV;QACE,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;YAClB,IAAI,SAAS,GAAG,uBAAa,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC,YAAY,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC;YAC1E,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;SAC5B;IACH,CAAC;IAED,4BAAM,GAAN,UAAO,EAAE;QAEP,IAAG,CAAC,IAAI,CAAC,QAAQ;YAClB,wEAAwE;YACvE,IAAI,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,aAAa,EAAE;gBAC1D,IAAI,CAAC,YAAY,CAAC,YAAY,GAAG,IAAI,CAAC;aACvC;iBAAM;gBACL,IAAI,CAAC,YAAY,CAAC,YAAY,GAAG,EAAE,CAAC;aACrC;IACH,CAAC;;IAnJM,uBAAW,GAAW,EAAE,CAAC;IAKhC;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;qDACI;IAGtB;QADC,QAAQ,CAAC,EAAE,CAAC,SAAS,CAAC;qDACI;IAG3B;QADC,QAAQ,CAAC,EAAE,CAAC,SAAS,CAAC;kDACC;IAGxB;QADC,QAAQ,CAAC,oBAAU,CAAC;+CACK;IAG1B;QADC,QAAQ;8CACS;IAGlB;QADC,QAAQ;sDACmB;IAO5B;QADC,QAAQ,CAAC,EAAE,CAAC,KAAK,CAAC;mDACE;IAKrB;QADC,QAAQ,CAAC,EAAE,CAAC,SAAS,CAAC;iDACA;IAGvB;QADC,QAAQ,CAAC,EAAE,CAAC,SAAS,CAAC;oDACG;IAG1B;QADC,QAAQ,CAAC,EAAE,CAAC,SAAS,CAAC;gDACD;IAvCH,WAAW;QAD/B,OAAO;OACa,WAAW,CAqJ/B;IAAD,kBAAC;CArJD,AAqJC,CArJwC,EAAE,CAAC,SAAS,GAqJpD;kBArJoB,WAAW","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\nimport Jump from \"./Jump\";\nimport RandomSpawner from \"./RandomSpawner\";\nimport AutoPatrol from \"./AutoPatrol\";\nimport AutoFilled from \"./AutoFilled\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class GameManager extends cc.Component {\n  static currentGoal: number = 16;\n\n  static instance: GameManager;\n\n  @property(cc.Node)\n  gameOverView: cc.Node;\n\n  @property(cc.RigidBody)\n  currentStair: cc.RigidBody;\n\n  @property(cc.RigidBody)\n  nextStair: cc.RigidBody;\n\n  @property(AutoPatrol)\n  patrol: AutoPatrol = null;\n    \n  @property\n  score: number = 0;\n\n  @property\n  stairStartPos: number = 450;\n\n  isJump = false;\n\n  canSpawn = false;\n\n  @property(cc.Label)\n  scoreLabel: cc.Label;\n\n  gameOver: false;\n  \n  @property(cc.AudioClip)\n  scoreSfx: cc.AudioClip;\n\n  @property(cc.AudioClip)\n  gameOverSfx: cc.AudioClip;\n\n  @property(cc.AudioClip)\n  jumpSfx: cc.AudioClip;\n  // LIFE-CYCLE CALLBACKS:\n\n    onLoad() {\n\n        GameManager.instance = this;\n      this.gameOver = false;\n        this.node.on(\n          \"gameOver\",\n          function () {\n            if (!this.gameOver) {\n              this.gameOver = true;\n              // console.log('game over');\n              cc.audioEngine.play(this.gameOverSfx, false, 1);\n              this.gameOverView.active = true;\n              if (this.currentStair.node != null)\n                this.currentStair.node.destroy();\n              if (this.nextStair.node != null)\n                this.nextStair.node.destroy();\n            }\n          },\n          this\n        );\n      \n        this.node.on(\n          \"addMoon\",\n          function (score) {\n           // cc.log(\"addScore\");\n            cc.audioEngine.play(this.scoreSfx, false, 1);\n            AutoFilled.instance.node.emit(\"fill\");\n           this.score+= score;\n           this.scoreLabel.string =  this.score.toString();\n          },\n          this\n        );\n    this.node.on(\n      \"addScore\",\n      function (score) {\n\n       // cc.log(\"addScore\");\n       cc.audioEngine.play(this.scoreSfx,false,1);\n       \n        this.addScore(score);\n        this.canSpawn = true;\n          this.nextStair.type = cc.RigidBodyType.Dynamic;\n      },\n      this\n    );\n    this.node.on(\n      \"spawnStair\",\n      () => {\n        if (this.canSpawn) {\n          this.canSpawn = false;\n          this.spawnStair();\n        }\n      },\n      this\n    );\n    this.node.on(\n        \"jump\",\n      function () {\n        if (!this.isJump) {\n        //  cc.log(\"player jump\");\n        cc.audioEngine.play(this.jumpSfx,false,2);\n          this.currentStair.type = cc.RigidBodyType.Dynamic;\n          this.currentStair.linearDamping = 0;\n          this.currentStair.gravity = 2;\n          this.currentStair = this.nextStair;\n          this.isJump = true;\n        }\n        },\n        this\n      );\n  }\n\n\n  addScore(score) {\n    if (this.score >= 10) {\n      this.patrol.enabled = true;\n    }\n    if (this.isJump) {\n\n      this.score += score;\n      this.scoreLabel.string = this.score.toString();\n      Jump.instance.node.emit(\"addScore\");\n     \n      //setTimeout(() => {\n     //   this.spawnStair();\n     // }, 1500); \n      this.isJump = false;\n    }\n  }\n\n  spawnStair() {\n    if (!this.gameOver) {\n      var nextStair = RandomSpawner.instance.spawn().getComponent(cc.RigidBody);\n      this.nextStair = nextStair;\n    }\n  }\n\n  update(dt) {\n\n    if(!this.gameOver)\n   // cc.log(this.currentStair.node.position.y + \",\" + this.stairStartPos);\n    if (this.currentStair.node.position.y > this.stairStartPos) {\n      this.currentStair.gravityScale = 2000;\n    } else {\n      this.currentStair.gravityScale = 10;\n    }\n  }\n}\n"]}