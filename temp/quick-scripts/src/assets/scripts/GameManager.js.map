{"version":3,"sources":["assets/scripts/GameManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\nimport Jump from \"./Jump\";\nimport RandomSpawner from \"./RandomSpawner\";\nimport GameData from \"./GameData\";\nimport AutoPatrol from \"./AutoPatrol\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class GameManager extends cc.Component {\n  static currentGoal: number = 16;\n\n  static instance: GameManager;\n\n  @property(cc.Node)\n  gameOverView: cc.Node;\n\n  @property(cc.RigidBody)\n  currentStair: cc.RigidBody;\n\n  @property(cc.RigidBody)\n  nextStair: cc.RigidBody;\n\n  @property(AutoPatrol)\n  patrol: AutoPatrol = null;\n  \n  @property\n  stairStartPos: number = 450;\n\n  isJump = false;\n\n  isDrop = true;\n\n  isSpawn = true;\n  @property(cc.Label)\n  scoreLabel: cc.Label;\n\n  gameOver: false;\n  \n  @property(cc.AudioClip)\n  scoreSfx: cc.AudioClip;\n\n  @property(cc.AudioClip)\n  gameOverSfx: cc.AudioClip;\n\n  @property(cc.AudioClip)\n  jumpSfx: cc.AudioClip;\n  // LIFE-CYCLE CALLBACKS:\n\n  onLoad() {\n    GameData.score = 0;\n      GameData.platformScale = 1;\n      GameData.patrolSpeed = 1;\n        GameManager.instance = this;\n      this.gameOver = false;\n        this.node.on(\n          \"gameOver\",\n          function () {\n            if (!this.gameOver ) {\n              this.gameOver = true;\n              // console.log('game over');\n              cc.audioEngine.play(this.gameOverSfx, false, 1);\n              this.gameOverView.active = true;\n              if (this.currentStair.node != null)\n                this.currentStair.node.destroy();\n              if (this.nextStair.node != null)\n                this.nextStair.node.destroy();\n            }\n          },\n          this\n        );\n      \n    this.node.on(\n      \"addScore\",\n      function (score) {\n       // cc.log(\"addScore\");\n       cc.audioEngine.play(this.scoreSfx,false,1);\n          this.addScore(score);\n          this.nextStair.type = cc.RigidBodyType.Dynamic;\n      },\n      this\n    );\n    this.node.on(\n      \"addMoon\",\n      function (score) {\n       // cc.log(\"addScore\");\n       cc.audioEngine.play(this.scoreSfx,false,1);\n       GameData.score+= score;\n       this.scoreLabel.string =  GameData.score.toString();\n      },\n      this\n    );\n    this.node.on(\n        \"jump\",\n      function () {\n        if (!this.isJump) {\n        //  cc.log(\"player jump\");\n        cc.audioEngine.play(this.jumpSfx,false,2);\n          this.currentStair.type = cc.RigidBodyType.Dynamic;\n          this.currentStair.linearDamping = 0;\n          this.currentStair.gravity = 2;\n          this.currentStair = this.nextStair;\n          this.isJump = true;\n         \n        }\n        },\n        this\n      );\n  }\n\n  addScore(score) {\n    if (GameData.score >= 10) {\n      this.patrol.enabled = true;\n    }\n    if (this.isJump) {\n      GameData.score += score;\n      this.scoreLabel.string =  GameData.score.toString();\n      Jump.instance.node.emit(\"addScore\");\n      this.isSpawn = false;\n      setTimeout(() => {\n        if (!this.isSpawn) {\n          this.isSpawn = true;\n          this.spawnStair();\n          this.isJump = false;\n        }\n       // this.spawnStair();\n      }, 1500); \n\n    }\n  }\n\n  spawnStair() {\n    if (!this.gameOver) {\n      var nextStair = RandomSpawner.instance.spawn().getComponent(cc.RigidBody);\n      this.nextStair = nextStair;\n    }\n  }\n\n  update(dt) {\n\n    if(!this.gameOver)\n   // cc.log(this.currentStair.node.position.y + \",\" + this.stairStartPos);\n      if (this.currentStair.node.position.y > this.stairStartPos) {\n      this.isDrop = true;\n      this.currentStair.gravityScale = 2000;\n    } else {\n      this.isDrop = false;\n      this.currentStair.gravityScale = 10;\n    }\n  }\n}\n"]}