{"version":3,"sources":["assets/scripts/bug.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\nimport Jump from \"./Jump\";\nimport RandomSpawner from \"./RandomSpawner\";\nimport GameData from \"./GameData\";\nimport AutoPatrol from \"./AutoPatrol\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class GameManager extends cc.Component {\n\n  //static currentGoal: number = 16;\n\n  static instance: GameManager;\n\n  @property(cc.Node)\n  gameOverView: cc.Node;\n\n  @property(cc.RigidBody)\n  currentStair: cc.RigidBody;\n\n  @property(cc.RigidBody)\n  nextStair: cc.RigidBody;\n\n  @property(AutoPatrol)\n  patrol: AutoPatrol = null;\n  \n  @property\n  stairStartPos: number = 450;\n\n // isJump = false;\n\n  //isDrop = true;\n\n  isSpawn = true;\n\n  @property(cc.Label)\n  scoreLabel: cc.Label;\n\n  gameOver: false;\n  \n  @property(cc.AudioClip)\n  scoreSfx: cc.AudioClip;\n\n  @property(cc.AudioClip)\n  gameOverSfx: cc.AudioClip;\n\n  @property(cc.AudioClip)\n  jumpSfx: cc.AudioClip;\n  // LIFE-CYCLE CALLBACKS:\n\n  onLoad() {\n    GameData.score = 0;\n     // GameData.platformScale = 1;\n    //  GameData.patrolSpeed = 1;\n    GameManager.instance = this;\n      this.gameOver = false;\n    this.node.on(\n      \"gameOver\",\n      function () {\n       // setTimeout(() => {\n          if (!this.gameOver) {\n            this.gameOver = true;\n            // console.log('game over');\n            cc.audioEngine.play(this.gameOverSfx, false, 1);\n            this.gameOverView.active = true;\n            if (this.currentStair.node != null)\n              this.currentStair.node.destroy();\n            if (this.nextStair.node != null)\n              this.nextStair.node.destroy();\n          }\n          },\n         // 500\n       // );\n      //},\n      this);\n           \n        this.node.on(\n          \"spawnStair\",\n          function () {\n            if (!this.isSpawn && GameData.score>=1) {\n              this.isSpawn = true;\n              this.spawnStair();\n             // this.isJump = false;\n            }\n          },\n          this\n        );\n      \n    this.node.on(\n      \"addScore\",\n      function (score) {\n       // cc.log(\"addScore\");\n       cc.audioEngine.play(this.scoreSfx,false,1);\n          this.addScore(score);\n          this.nextStair.type = cc.RigidBodyType.Dynamic;\n      },\n      this\n    );\n    this.node.on(\n      \"addMoon\",\n      function (score) {\n       // cc.log(\"addScore\");\n       cc.audioEngine.play(this.scoreSfx,false,1);\n       GameData.score+= score;\n       this.scoreLabel.string =  GameData.score.toString();\n      },\n      this\n    );\n    this.node.on(\n        \"jump\",\n      function () {\n      //  if (!this.isJump) {\n        //  cc.log(\"player jump\");\n        cc.audioEngine.play(this.jumpSfx,false,2);\n          this.currentStair.type = cc.RigidBodyType.Dynamic;\n          this.currentStair.linearDamping = 0;\n          this.currentStair.gravity = 2;\n          this.currentStair = this.nextStair;\n         // this.isJump = true;\n         \n      //  }\n        },\n        this\n      );\n  }\n\n  addScore(score) {\n    if (GameData.score >= 10) {\n      this.patrol.enabled = true;\n    }\n    //if (this.isJump) {\n      GameData.score += score;\n      this.scoreLabel.string =  GameData.score.toString();\n      Jump.instance.node.emit(\"addScore\");\n     this.isSpawn = false;\n    /*  setTimeout(() => {\n        if (!this.isSpawn) {\n          this.isSpawn = true;\n          this.spawnStair();\n          this.isJump = false;\n        }\n       // this.spawnStair();\n      }, 1500); */\n\n   // }\n  }\n\n  spawnStair() {\n    if (!this.gameOver) {\n      var nextStair = RandomSpawner.instance.spawn().getComponent(cc.RigidBody);\n      this.nextStair = nextStair;\n    }\n  }\n\n  update(dt) {\n\n    if (!this.gameOver) {\n      cc.log(\"startdrop\" + this.currentStair.node.position.y +\"/\"+this.stairStartPos);\n      // cc.log(this.currentStair.node.position.y + \",\" + this.stairStartPos);\n      if (this.currentStair.node.position.y > this.stairStartPos) {\n        cc.log(\"drop\" + dt);\n       // this.isDrop = true;\n        this.currentStair.gravityScale = 2000;\n      } else {\n       // this.isDrop = false;\n        this.currentStair.gravityScale = 10;\n      }\n    }\n  }\n}\n"]}